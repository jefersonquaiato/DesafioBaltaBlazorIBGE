@using DesafioBaltaBlazorIBGE.Data.Repositories
@using DesafioBaltaBlazorIBGE.Data

@inject ApplicationDbContext Context
@inject NavigationManager NavigationManager
@rendermode InteractiveServer
@attribute [StreamRendering(true)]

<h3>New City</h3>

<EditForm Model="@Model" OnValidSubmit="HandleSubmitAsync">
    <DataAnnotationsValidator />

    <div class="mb-3">
        <label class="form-label">UF</label>
        <InputText id="UF" type="text" class="form-control" @bind-Value="Model.State" />
        <ValidationMessage For="@(() => Model.State)" />
    </div>

    <div class="mb-3">
        <label class="form-label">Cidade</label>
        <InputText id="CityName" type="text" class="form-control" @bind-Value="Model.City" />
        <ValidationMessage For="@(() => Model.City)" />
    </div>

    <button class="btn btn-success" type="submit">
        SAVE
    </button>
</EditForm>

@code {
    private Ibge Model { get; set; } = new();
    private bool? _errorMessage = null;

    async Task HandleSubmitAsync()
    {
        try
        {
            await Context.Ibges.AddAsync(Model);
            await Context.SaveChangesAsync();
            NavigationManager.NavigateTo($"/cities");
        }
        catch
        {
            _errorMessage = false;
        }
    }
}